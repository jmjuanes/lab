<html>
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, user-scalable=no">
        <meta name="title" content="Pixlab">
        <meta name="description" content="">
        <meta property="og:site_name" content="Pixlab">
        <meta property="og:title" content="Pixlab">
        <meta property="og:type" content="website" />
        <meta property="og:url" content="https://www.josemi.xyz/pixlab" />
        <meta property="og:image" content="https://www.josemi.xyz/pixlab/header.png" />
        <meta property="og:image:width" content="1200" />
        <meta property="og:image:height" content="630" />
        <meta property="og:image:alt" content="Pixlab" />
        <meta property="description" content="" />
        <title>Pixlab</title>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700;900&display=swap">
        <link rel="stylesheet" href="./node_modules/lowcss/dist/low.css">
        <link rel="stylesheet" href="./pixlab.css">
    </head>
    <body class="m-0 font-inter text-base leading-normal bg-neutral-950 text-neutral-50">
        <div class="flex items-center justify-between w-full max-w-7xl h-20 mx-auto px-6">
            <div class="select-none flex items-center text-2xl">
                <span class="font-black">pixlab.</span>
            </div>
            <div class="flex items-center gap-2 select-none">
                <div class="rounded-md hover:bg-neutral-800 py-2 px-3 cursor-pointer">
                    <span>Settings</span>
                </div>
            </div>
        </div>
        <div class="w-full max-w-6xl mx-auto px-6 py-4">
            <div class="fixed w-full h-screen z-10 top-0 left-0 bg-neutral-950">
                <div class="flex flex-col flex-nowrap h-full">
                    <div class="h-20 flex items-center justify-center">
                        <div id="editor:tools" class="rounded-lg border border-neutral-700 flex items-center gap-1 p-1">
                        </div>
                    </div>
                    <div class="flex items-center justify-center w-full">
                        <div class="bg-white text-neutral-700 max-w-lg w-full" id="editor:canvas"></div>
                    </div>
                </div>
            </div>
        </div>
        <script type="module">
            import * as Pixlab from "./pixlab.js";

            const createDomElement = content => {
                const templateElement = document.createElement("template");
                templateElement.innerHTML = content.trim();
                return templateElement.content.firstChild;
            };

            const createToolButton = (tool, icon) => {
                const buttonClass = [
                    "flex items-center p-2 rounded-md border-0",
                ];
                const buttonContent = [
                    `<button data-tool="${tool}" class="${buttonClass.join(" ")}">`,
                    `    <svg class="w-6 h-6">`,
                    `        <use xlink:href="./node_modules/@josemi-icons/svg/sprite.svg#${icon}"></use>`,
                    `   </svg>`,
                    `</button>`,
                ];
                return createDomElement(buttonContent.join(""));
            };
 
            const initializeEditor = (canvasWidth, canvasHeight) => {
                let currentTool = "brush";
                let currentColor = "blue";

                // Initialize canvas
                const canvas = Pixlab.create(document.getElementById("editor:canvas"), {
                    width: canvasWidth,
                    height: canvasHeight,
                    color: currentColor,
                    grid: false,
                });
                // Initialize tools
                const availableTools = {
                    brush: {
                        icon: "pencil",
                        defaultActive: true,
                        onClick: () => {
                            canvas.setColor("blue");
                        },
                    },
                    eraser: {
                        icon: "erase",
                        defaultActive: false,
                        onClick: () => {
                            canvas.setColor(Pixlab.TRANSPARENT);
                        },
                    },
                };
                const defaultToolButtonClass = "bg-transparent text-white hover:bg-white hover:text-neutral-900".split(" ");
                const activeToolButtonClass = "bg-white text-neutral-900".split(" ");
                const toolsParent = document.getElementById("editor:tools");
                toolsParent.replaceChildren();
                Object.entries(availableTools).forEach(([toolKey, toolConfig]) => {
                    const button = createToolButton(toolKey, toolConfig.icon);
                    toolsParent.appendChild(button);
                    button.addEventListener("click", () => {
                        // 1. Reset active state of all tool buttons
                        Array.from(toolsParent.querySelectorAll(`button[data-tool]`)).forEach(btn => {
                            btn.classList.remove(...activeToolButtonClass);
                        });
                        // 2. Set this button as active
                        button.
                        button.setAttribute("checked", "");
                        toolConfig.onClick();
                    });
                    // Check to initialize this button as active by default
                    if (toolConfig.defaultActive) {
                        button.setAttribute("checked", "");
                    }
                });
            };

            initializeEditor(32, 32);
        </script>
    </body>
</html>
